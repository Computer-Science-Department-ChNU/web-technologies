<!DOCTYPE html>
<html lang="uk">
<head>
    <title>Тема 16. Події (Events)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="../../../core/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
</head>
<body class="shower list">

<header class="caption">
    <h1>Тема 16. Події (Events)</h1>
</header>

<section class="slide">
    <h2>Тема 16. Події (Events)</h2>
    <ol style="font-size: 19px;">
        <li>Вступ до подій</li>
        <li>Основні події</li>
        <li>Встановлення обробників події</li>
        <li>Ключове слово this в обробнику події</li>
        <li>Об'єкт події</li>
        <li>Події DOMContentLoaded та load</li>
        <li>Події миші</li>
        <li>Події клавіатури</li>
        <li>Фази проходу події</li>
        <li>Реєстрація обробника події на різних фазах</li>
        <li>Скасування поширення події та скасування дії за замовчуванням</li>
    </ol>
</section>

<section class="slide">
    <h2>Подія</h2>
    <div class="columns two">
        <div>
            <p><b>Подія</b> – це сигнал, який повідомляє про настання певного стану деякого об'єкта.</p>
            <b>Наприклад:</b>
            <ol>
                <li>кнопка натиснута</li>
                <li>курсор увійшов до області елемента</li>
                <li>на клавіатурі натиснута клавіша</li>
            </ol>
            <p><b>Обробник події</b> – функція, яка запускається у разі виникнення події.</p>
        </div>
        <img style="margin-top: 45%" src="images/1.png" alt="" width="100%">
    </div>
</section>

<section class="slide">
    <h2>Основні події</h2>
    <div class="columns two">
        <ul>
            <li><b>click</b>
                натискання лівої клавіші миші
            </li>
            <li><b>contextmenu</b>
                натискання правої клавіші миші
            </li>
            <li><b>keydown</b>
                клавіша на клавіатурі затиснута
            </li>
            <li><b>keyup</b>
                клавішу на клавіатурі відпущено
            </li>
            <li><b>submit</b>
                користувач надіслав форму (натиснув
                кнопку submit для form)
            </li>
        </ul>
        <ul>
            <li><b>mouseout</b>
                курсор вийшов за межі елемента
            </li>
            <li><b>mouseover</b>
                курсор увійшов у область елемента
            </li>
            <li><b>mousedown</b>
                затиснута клавіша миші
            </li>
            <li><b>mouseup</b>
                відпущена клавіша миші
            </li>
            <li><b>mousemove</b>
                курсор переміщається елементом
            </li>
        </ul>
    </div>
    <a href="https://developer.mozilla.org/ru/docs/Web/Events" target="_blank">Перелік подій
        https://developer.mozilla.org/ru/docs/Web/Events</a>
</section>

<section class="slide">
    <h2>Встановлення обробників</h2>
    <img src="images/2.png" alt="" width="100%">
</section>

<section class="slide">
    <h2>Встановлення обробників</h2>
    <ul>
        <li>Обробник може бути встановлений за допомогою атрибута HTML розмітки. Це один із
            способів встановлення обробників, яких слід уникати, оскільки у такому випадку
            відбувається змішування логіки інтерфейсу (HTML) та бізнес-логіки (JavaScript). Слід завжди
            прагнути такої структури коду, щоб розмітка відокремлювалася від сценаріїв. Такий код
            легше супроводжувати та розширювати.
        </li>
        <li>Щоб встановити обробник події через JavaScript код, необхідно визначити функцію та
            додати її як значення для властивості з ім'ям події, яку необхідно обробити. Даний підхід має кілька
            недоліків, один з них – на одну подію одного елемента можна
            додати лише один обробник. При додаванні другого оброблювача, перший обробник
            видаляється.

        </li>
        <li>Найоптимальнішим способом встановлення обробника події є метод addEventListener</li>
    </ul>
</section>

<section class="slide">
    <h2>Встановлення обробників</h2>
    <b>addEventListener (event, handler, options)</b>
    <ul>
        <li>event – ім'я події, без приставки on (click, mousedown тощо)</li>
        <li>handler – функція, яка встановлюється як обробник.</li>
        <li>options – додаткові параметри</li>
    </ul>
    <p>У такий спосіб можна додати кілька обробників на одну подію того самого елемента
        сторінки.</p>
    <p>Щоб видалити обробник, який був встановлений через addEventListener, потрібно
        використовувати метод removeEventListener</p>
</section>

<section class="slide">
    <h2>Встановлення обробників</h2>
    <p>
        Метод removeEventListener у JavaScript використовується для видалення обробника подій, який був раніше доданий
        за допомогою addEventListener. Це важливо з кількох причин:
    </p>
    <ul style="font-size: 16px;">
        <li>Якщо обробник події залишається привʼязаним до елемента, який вже не використовується або видалений з DOM,
            це може призвести до витоку памʼяті:
            <ul>
                <li>Оскільки браузер не може "прибрати" цей елемент зі своєї памʼяті, поки існує посилання через
                    обробник;
                </li>
                <li>Особливо актуально для SPA (single-page applications), де сторінка не перезавантажується, і
                    "сміття" накопичується
                </li>
            </ul>
        </li>
        <li>Уникнення повторного спрацювання одного й того ж обробника. Якщо ви декілька разів викликаєте
            addEventListener, не видаляючи старі обробники, то один і той самий обробник може спрацьовувати кілька разів
            — це може викликати баги або неочікувану поведінку.
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Встановлення обробників</h2>
    <b>
        Поради по роботі з removeEventListener
    </b>
    <ul style="font-size: 18px;">
        <li>Якщо при додаванні обробника події було використано додаткові опції, то при видаленні обробника необхідно
            вказати ці ж опції, щоб вказати, який саме обробник потрібно видалити.
        </li>
        <li>Використання removeEventListener() є важливим для оптимізації продуктивності вебзастосунків. Видалення
            непотрібних обробників подій допомагає уникнути витоків пам'яті, особливо в односторінкових додатках, де
            елементи DOM можуть динамічно додаватися та видалятися. Тому регулярно переглядайте свій код на предмет
            неактивних слухачів подій та видаляйте їх.
        </li>
        <li>Коли ви використовуєте removeEventListener() для видалення обробника події з елемента, переконайтеся, що цей
            елемент все ще існує в DOM. Якщо елемент було видалено, спроби видалити обробник події з нього будуть
            марними. Також, якщо ви працюєте з динамічно генерованими елементами, забезпечте наявність механізму для
            відстеження та видалення обробників подій перед видаленням цих елементів з DOM.
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Ключове слово this в обробнику події</h2>
    <p>
        Якщо в обробнику використовувати ключове слово this, можна отримати доступ до
        об'єкта, який ініціював подію.
    </p>
    <p>Наприклад, якщо в обробнику кнопки на подію click
        використовувати this, можна отримати доступ до самої кнопки, по якій виконали клік, а
        також отримати значення властивостей цієї кнопки.</p>
    <p> Це зручно використовувати тоді, коли
        той самий обробник використовується для різних елементів на сторінці.</p>
</section>

<section class="slide">
    <h2>Підсумки</h2>
    <p>
        <b>Подія</b> – основний спосіб реагувати на дії користувача та виконувати код. Для обробки події потрібно
        встановити обробник події у вигляді JavaScript функції.
    </p>
    <b>Обробник можна встановити через:</b>
    <ul>
        <li>атрибут on+назва_події в розмітці</li>
        <li>властивості on+ім'я_події у JavaScript коді</li>
        <li>метод addEventListener</li>
    </ul>
    <p>Метод addEventListener дозволяє встановити кілька обробників на одну подію та підтримує
        маршрутизацію подій.</p>
    <p style="color: #cc0000">Приклади в директорії js/16-events/examples/events-1</p>
</section>

<section class="slide">
    <h2>Об'єкт події Event</h2>
    <div class="columns two">
        <div>
            <p>Подія, що виникла в DOM, є об'єктом, якому можна отримати доступ через параметр методу
                обробника.
            </p>
            <p>
                <b>Event</b> - інтерфейс, який представляє подію, що виникла в DOM. (Під інтерфейсом мається на увазі
                набір
                властивостей та методів).
            </p>
        </div>
        <img src="images/3.png" alt="" width="120%">
    </div>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/Event</a>
</section>

<section class="slide">
    <h2>Об'єкт події Event</h2>
    <p>HTML сторінка має три основні події.</p>
    <ul>
        <li><b>DOMContentLoaded</b> – браузер завантажив розмітку та побудував DOM дерево, але
            зовнішні ресурси, наприклад, картинки, можуть завантажуватися. Ця подія спрацьовує на
            об'єкті document. Використовується щоб виконати JavaScript-код, як тільки доступна структура DOM, але ще до
            повного завантаження всіх ресурсів (що швидше за load).
        </li>
        <li><b>load</b> – HTML та зовнішні ресурси завантажені. Ця подія спрацьовує на об'єкті window. Використовується
            щоб виконати код
            після повного завантаження всього вмісту, наприклад, обробка зображень, ініціалізація слайдерів тощо.
        </li>
        <li><b>beforeunload/unload</b> - Перед тим як користувач залишає сторінку (перезавантажує, закриває, переходить
            кудись).
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Об'єкт події Event</h2>
    <p><b>Об'єкт події</b> – об'єкт, який створює браузер у момент виникнення події. Цей об'єкт
        передається як перший аргумент у функцію «обробник події» і може бути використаний
        для отримання додаткової інформації про подію. Наприклад, положення курсора,
        затискання клавіші на клавіатурі чи миші.</p>
    <img src="images/4.png" alt="" width="740">
</section>

<section class="slide">
    <h2>Об'єкт події Event</h2>
    <p> Під час роботи з подіями миші можна виділити дві категорії подій – прості та комплексні.
        Комплексні події будуються з урахуванням простих подій.</p>
    <div class="columns two" style="font-size: 19px;">
        <div>
            <b>Прості події:</b>
            <ul>
                <li>mousedown – кнопка миші натиснута</li>
                <li>mouseup – кнопка миші відпущена</li>
                <li>mousemove – рух миші над елементом</li>
                <li>mouseover – курсор з'явився над елементом</li>
                <li>mouseout – курсор йде з елемента</li>
                <li>contextmenu - затиснута права клавіша миші.</li>
            </ul>
        </div>
        <div>
            <b>Комплексні події:</b>
            <ul>
                <li>click – mousedown та mouseup над цим же елементом</li>
                <li>dblclick – подвійний клік на елементі</li>
            </ul>
        </div>
    </div>
</section>

<section class="slide">
    <h2>Події миші</h2>
    <p>Під час обробки події, пов'язаної з кліком, можна дізнатися клавішу миші, яка
        використовувалася для кліка. Для цього необхідно отримати значення властивості which
        об'єкта події, яке передавалося в метод обробника події. Значення 1 – затиснута ліва
        клавіша, 2 – середня клавіша (колесо), 3 – права клавіша миші.
    </p>
    <p>Також об'єкт події містить властивості, які визначають, які клавіші були затиснуті на
        клавіатурі під час події – shiftKey, altKey, ctrlKey, metaKey (Cmd для Mac).</p>
    <p>Для отримання координат курсора використовуються властивості clientX, clientY, pageX та
        pageY.
        <b>Client</b> – координати щодо вікна.
        <b>Page</b> – координати щодо документа (документ може скролитись і частина документа
        перебувати за межами видимої частини вікна).
    </p>
</section>

<section class="slide">
    <h2>Події клавіатури</h2>
    <p>Якщо завдання реагувати на взаємодію користувача з клавіатурою – обробляти
        натискання на стрілочки, комбінації клавіш або певні клавіші, використовуються події
        keydown та keyup
    </p>
    <p>Під час обробки події в об'єкті події є дві властивості, пов'язані з клавішею code і key.
        <br>
        <b>Key</b> – символ клавіші (змінюється відповідно до мови користувача).
        br
        <b>Code</b> – фізичний код кнопки</p>
    <p style="color: #cc0000">Приклади в директорії js/16-events/examples/events-2</p>
</section>

<section class="slide">
    <h2>Фази проходу події</h2>
    <div class="columns two">
        <ul>
            <li><b style="color: blue">Capturing Phase (1)</b> – фаза занурення або фаза
                перехоплення, подія йде зверху донизу, від кореневого
                елемента до того, що ініціював подію
            </li>
            <li><b style="color: orange">At Target Phase (2)</b> – подія досягла цільового елемента.
            </li>
            <li><b style="color: green">Bubbling Phase (3)</b> - фаза спливу, подія рухається від
                цільового елемента до кореневого.
            </li>
        </ul>
        <img src="images/5.png" alt="" width="100%">
    </div>
</section>

<section class="slide">
    <h2>Фази проходу події</h2>
    <p>Фаза <b>перехоплення (Capturing Phase)</b> використовується досить рідко. В основному використовується <b>фаза
        спливання (Bubbling Phase)</b>, <u>оскільки вона дозволяє зробити один обробник події на контейнері, в якому
        знаходиться кілька елементів, які ініціюють подію</u>.</p>
    <p>
        Цей підхід називається <b>делегування подій (Event delegation)</b> – дочірні елементи делегують опрацювання
        події батьківському елементу.
        Водночас
        один обробник на контейнері оброблятиме події від усіх вкладених елементів.
    </p>
    <p style="font-size: 16px;">Такий підхід
        дозволяє заощадити оперативну пам'ять, тому що потрібен лише один обробник замість
        кількох. Також це спрощує розширення програми, оскільки з додаванням нових елементів
        немає потреби створювати для них обробники.</p>
</section>

<section class="slide">
    <h2>Фази проходу події</h2>
    <p>Об'єкт події надає властивість event.target, яка містить найглибший елемент, що викликав
        подію (цільовий елемент).</p>
    <p><b>Event.target</b> – цільовий елемент, у процесі проходу події його значення не змінюється. </p>
    <p>У свою чергу, значення this завжди містить поточний елемент, до якого дійшла подія. </p>
    <p>На етапі перехоплення та на етапі спливання значення this та event.target будуть відрізнятися.
    </p>
</section>

<section class="slide">
    <h2>Реєстрація обробника події на різні фази</h2>
    <p style="font-size: 16px;">За замовчуванням усі обробники події реєструються на фазі спливання. Для реєстрації на
        фазі перехоплення необхідно додати в addEventListener третій параметр - true. Значення true – фаза capture,
        значення false чи відсутність параметра – фаза bubble.</p>
    <img src="images/6.png" alt="" width="100%">
</section>

<section class="slide">
    <h2>Скасування поширення події та скасування дії за замовчуванням</h2>
    <p>
        Щоб припинити перехід події до наступного елемента, необхідно викликати метод
        <b>event.stopPropagation()</b>.
    </p>
    <p>Для скасування стандартної дії, яка пов'язана з подією, необхідно викликати метод
        <b>event.stopPropagation()</b>. Наприклад, для події submit форми, відбувається уривок
        мережного запиту. Якщо в обробнику події буде викликаний метод <b>preventDefault()</b>, то
        відправка запиту буде скасована</p>
    <p>Деякі події не спливають, наприклад, подія focus, blur не підтримують цю фазу.</p>
    <p style="color: #cc0000">Приклади в директорії js/16-events/examples/events-3</p>
</section>

<section class="slide">
    <h2>Рекомендовані ресурси</h2>
    <ul>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/Scripting/Events"
               target="_blank">Introduction to events</a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/Events/Event_handlers" target="_blank">Event handling
                (overview)</a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/Events" target="_blank">Event reference</a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event" target="_blank">DOMContentLoaded</a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event" target="_blank">Window: load
                event
            </a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent" target="_blank">KeyboardEvent
            </a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/Scripting/Event_bubbling"
               target="_blank">Event bubbling
            </a>
        </li>
        <li>
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/stopPropagation" target="_blank">Event:
                stopPropagation() method
            </a>
        </li>
        <li>
            <a href="https://davidwalsh.name/event-delegate" target="_blank">How JavaScript Event Delegation Works
            </a>
        </li>
    </ul>
</section>

<section class="slide">
    <h2>Контрольні питання</h2>
    <ol style="font-size: 12px;">
        <li>Що таке подія?</li>
        <li>Назвіть події, пов'язані з клавіатурою.</li>
        <li>Назвіть події, пов'язані з рухом курсора.</li>
        <li>Як встановити обробник через розмітку?</li>
        <li>Які способи встановлення обробників через JavaScript код ви знаєте?</li>
        <li>У чому перевага використання addEventListener перед іншими варіантами?</li>
        <li>У чому різниця між подіями load та DOMContentLoaded?</li>
        <li>Як можна попередити користувача про те, що він має намір залишити сторінку?</li>
        <li>Як дізнатися, яка клавіша миші була затиснута під час обробки події click?</li>
        <li>Як дізнатися, чи кнопка shift затиснута під час обробки події click?</li>
        <li>У чому різниця між властивостями clientY та pageY?</li>
        <li>Як отримати інформацію про те, яка клавіша на клавіатурі була затиснута?</li>
        <li>Назвіть фази переходів.
        <li>Чим відрізняється властивість event.target від ключового слова в функції обробника
            події?
        </li>
        <li>Як встановити обробник, який спрацює на фазі перехоплення?</li>
        <li>Як можна зупинити перехід події вузлами DOM дерева?</li>
        <li>Як можна скасувати стандартну дію, пов'язану з подією?</li>
        <li>Наведіть приклади використання перехоплення подій для вирішення прикладного
            завдання
        </li>
    </ol>
</section>

<section class="slide">
    <h2 class="shout">Дякую за увагу!</h2>
</section>

<div class="progress"></div>

<script src="../../../core/shower.js"></script>
</body>
</html>

